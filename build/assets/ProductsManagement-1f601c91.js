var de=Object.defineProperty;var pe=(e,t,a)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var A=(e,t,a)=>(pe(e,typeof t!="symbol"?t+"":t,a),a);import{p as j,j as s,P as q,C as ue}from"./mui-2493782d.js";import{P as me}from"./PageHeader-03cf4441.js";import{_ as he,g as ge,w as xe,u as fe,a as be,j as W,m as je,s as ye,x as R,y as Se,z as ve,F as Ce,B as Pe,C as we,D as Ne,v as _e,E as z,o as H,n as Oe,q as ke,G as Ae}from"./index-f3827da5.js";import{h as J,T as Ee,C as Fe,r as p}from"./antd-1d728b6a.js";import{S as N}from"./index-c6afdd95.js";import{E as Te}from"./Empty-c4cdbd71.js";import{P as Re}from"./Pagination-94a491c8.js";import{S as De}from"./SubmenuTrigger-34b58daa.js";import{P as Ue}from"./columnDefs-a59d07dd.js";import{r as Le}from"./commonFunction-2972f58c.js";import"./DocumentTitle-62345d26.js";import"./RatingStars-719637f9.js";import"./Timestamp-eb25fa85.js";import"./Trend-1bb25368.js";import"./Counter-934451c1.js";import"./helpers-22670235.js";const Be=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Z=e=>Array.isArray(e)&&e.every(t=>typeof t=="object"&&!(t instanceof Array)),Ie=e=>Array.isArray(e)&&e.every(t=>Array.isArray(t)),Me=e=>Array.from(e.map(t=>Object.keys(t)).reduce((t,a)=>new Set([...t,...a]),[])),$e=(e,t)=>{t=t||Me(e);let a=t,r=t;Z(t)&&(a=t.map(l=>l.label),r=t.map(l=>l.key));const i=e.map(l=>r.map(o=>qe(o,l)));return[a,...i]},qe=(e,t)=>{const a=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(r,i,l,o){const c=r[i];if(c==null)o.splice(1);else return c},t);return a===void 0?e in t?t[e]:"":a},Ge=e=>typeof e>"u"||e===null?"":e,X=(e,t=",",a='"')=>e.filter(r=>r).map(r=>r.map(i=>Ge(i)).map(i=>`${a}${i}${a}`).join(t)).join(`
`),Ke=(e,t,a,r)=>X(t?[t,...e]:e,a,r),Ve=(e,t,a,r)=>X($e(e,t),a,r),ze=(e,t,a,r)=>t?`${t.join(a)}
${e}`:e.replace(/"/g,'""'),Y=(e,t,a,r)=>{if(Z(e))return Ve(e,t,a,r);if(Ie(e))return Ke(e,t,a,r);if(typeof e=="string")return ze(e,t,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},ee=(e,t,a,r,i)=>{const l=Y(e,a,r,i),o=Be()?"application/csv":"text/csv",c=new Blob([t?"\uFEFF":"",l],{type:o}),x=`data:${o};charset=utf-8,${t?"\uFEFF":""}${l}`,f=window.URL||window.webkitURL;return typeof f.createObjectURL>"u"?x:f.createObjectURL(c)},te={data:j.oneOfType([j.string,j.array,j.func]).isRequired,headers:j.array,target:j.string,separator:j.string,filename:j.string,uFEFF:j.bool,onClick:j.func,asyncOnClick:j.bool,enclosingCharacter:j.string},se={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},He={target:"_blank"};class Q extends J.Component{constructor(t){super(t),this.state={}}buildURI(){return ee(...arguments)}componentDidMount(){const{data:t,headers:a,separator:r,enclosingCharacter:i,uFEFF:l,target:o,specs:c,replace:x}=this.props;this.state.page=window.open(this.buildURI(t,l,a,r,i),o,c,x)}getWindow(){return this.state.page}render(){return null}}A(Q,"defaultProps",Object.assign(se,He)),A(Q,"propTypes",te);var T;let Qe=(T=class extends J.Component{constructor(t){super(t),this.buildURI=this.buildURI.bind(this)}buildURI(){return ee(...arguments)}handleLegacy(t,a=!1){if(window.navigator.msSaveOrOpenBlob){t.preventDefault();const{data:r,headers:i,separator:l,filename:o,enclosingCharacter:c,uFEFF:x}=this.props,f=a&&typeof r=="function"?r():r;let b=new Blob([x?"\uFEFF":"",Y(f,i,l,c)]);return window.navigator.msSaveBlob(b,o),!1}}handleAsyncClick(t){const a=r=>{if(r===!1){t.preventDefault();return}this.handleLegacy(t,!0)};this.props.onClick(t,a)}handleSyncClick(t){if(this.props.onClick(t)===!1){t.preventDefault();return}this.handleLegacy(t)}handleClick(){return t=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(t):this.handleSyncClick(t);this.handleLegacy(t)}}render(){const{data:t,headers:a,separator:r,filename:i,uFEFF:l,children:o,onClick:c,asyncOnClick:x,enclosingCharacter:f,...b}=this.props,v=typeof window>"u"?"":this.buildURI(t,l,a,r,f);return s.jsx("a",{download:i,...b,ref:h=>this.link=h,target:"_self",href:v,onClick:this.handleClick(),children:o})}},A(T,"defaultProps",se),A(T,"propTypes",te),T);const We=Qe,Je=he(Ee).withConfig({displayName:"styles__StyledTable",componentId:"sc-k8b1p0-0"})(["flex-grow:1;.ant-spin-nested-loading,.ant-spin-container{height:100%;}.ant-spin-container{display:flex;flex-direction:column;}.ant-table{flex-grow:1;background:transparent;}.ant-table-thead .ant-table-cell{background:var(--widget);padding:30px 15px 20px !important;border-bottom:1px solid var(--border) !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{text-align:right;padding-right:24px !important;}}.ant-table-tbody .ant-table-cell{border:none !important;padding:30px 15px !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{padding-right:24px !important;}}"]),ae=({product:e,activeCollapse:t,handleCollapse:a})=>{const r=e.product_quantity;return s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(Fe,{}),s.jsxs("div",{className:"flex items-center gap-2.5",children:[s.jsx("div",{className:"img-wrapper w-[40px] h-[40px] flex items-center justify-center",children:s.jsx("img",{src:(e==null?void 0:e.product_thumb_small)??(e==null?void 0:e.product_thumb),alt:"product"})}),s.jsx("h6",{className:"text-sm max-w-[70px] truncate",children:e.product_sku})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:`collapse-btn ${t===e._id?"active":""}`,"aria-label":"Toggle view",onClick:()=>a(e._id),children:s.jsx("i",{className:"icon icon-caret-down-solid"})}),s.jsx(ge,{to:"/product-editor","aria-label":"Edit",children:s.jsx("i",{className:"icon icon-pen-to-square-regular"})}),s.jsx(De,{})]})]}),s.jsx(ue,{in:t===e._id,children:s.jsx("table",{className:"basic-table",children:s.jsxs("tbody",{children:[s.jsx("tr",{children:s.jsx("td",{colSpan:2,children:"Product"})}),s.jsx("tr",{children:s.jsx("td",{colSpan:2,children:s.jsxs("div",{className:"flex gap-2.5",children:[s.jsx("div",{className:"img-wrapper w-[45px] h-[45px] flex items-center justify-center",children:s.jsx("img",{src:(e==null?void 0:e.product_thumb_small)??(e==null?void 0:e.product_thumb),alt:"product"})}),s.jsx("h6",{className:"text-sm max-w-[155px]",children:e.product_name})]})})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["SKU: ",e.product_sku]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Stock status:",r==null?"On Demand":s.jsxs("span",{children:[s.jsx("span",{className:`${r!==0?"text-green":"text-red"}`,children:r!==0?r>=xe?"In stock ":"Low Inventory ":"Out of stock "}),"(",r,")"]})]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Price: $",e.product_price]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Category:",s.jsx("button",{className:"capitalize text-accent ml-1",children:e.product_type})]})})]})})})]})};ae.propTypes={product:q.object.isRequired,activeCollapse:q.string.isRequired,handleCollapse:q.func.isRequired};const Ze=({data:e,limit:t=10,totalPages:a,totalCount:r})=>{const[i,l]=p.useState(0),o=r??e.length,c=a??Math.ceil(e.length/t),x=()=>e;return p.useEffect(()=>{i>c-1?l(c-1):i<0&&c>0&&l(0)},[x()]),{next:()=>{l(h=>Math.min(h+1,c))},prev:()=>{l(h=>Math.max(h-1,0))},goToPage:h=>{const y=Math.max(0,h);l(()=>Math.min(y,c))},showingOf:()=>{const h=i*t,y=o>t?h+t:o;return o>0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"font-semibold",children:y}),"/",o]}):""},currentItems:x,currentPage:i,setCurrentPage:l,maxPage:c}},Xe=({products:e=[],options:t,status:a,userInfo:r,cb_setParamsPage:i,cb_setParamsStatus:l,cb_setParamsFilter:o,cb_onGetProductsByShop:c})=>{const x=fe(),{width:f}=be(),b=W(je),w={stockStatus:null,product_categories:null,productSeller:null,brand:null,additionalOptions:null},[v,h]=p.useState([]),[y,D]=p.useState("all"),[d,u]=p.useState(w),[C,_]=p.useState(null),[E,O]=p.useState(""),U=n=>({all:(t==null?void 0:t.countAll)??e.length,trash:(a==null?void 0:a.isDelete)??0,publish:(a==null?void 0:a.isPublished)??0,draft:(a==null?void 0:a.isDraft)??0})[n]??0,P=({value:n,label:m},g)=>{u($=>({...$,[g]:{label:m,value:n}}))},L=()=>{const n=Le(d),m={};Object.keys(n).forEach(g=>{g==="product_categories"&&(m[g]=n[g].value),g==="brand"&&(m[g]=n[g].value)}),console.log(m),o&&(o(m),h([]),S.setCurrentPage(0))},[B,{isLoading:I,error:G}]=ye(),M=async n=>{const m=await B(n),g=m==null?void 0:m.data;g!=null&&g.metadata?(c&&c(),h([]),x(H({isOpen:Date.now(),content:"Updated Success",step:1}))):x(H({isOpen:Date.now(),content:"Update Failed",step:2}))},K=()=>{var g;const n=(g=z.find($=>$.value===C.value))==null?void 0:g.bodyUpdate,m={ids:v,bodyUpdate:n,product_shop:r==null?void 0:r._id};M(m)},k=()=>{u(w)},S=Ze({...t,data:(()=>y==="all"?e:e.filter(n=>n.status===y))(),limit:R});p.useEffect(()=>{O(""),i&&(h([]),i({page:+S.currentPage>0?+S.currentPage+1:1}))},[S.currentPage,f]);const ne=n=>{O(E===n?"":n)},re=n=>{h(n)};p.useState("All");const[le,ie]=p.useState([]),{data:F,error:Ye,isSuccess:oe,isLoading:et}=Se({page:1,limit:1e3},{refetchOnMountOrArgChange:!0,skip:!1});p.useEffect(()=>{oe&&ie(F==null?void 0:F.brands.map(n=>({value:n._id,label:n.brand})))},[F]);const ce=v.length===0||!C;return s.jsxs("div",{className:"flex flex-col flex-1",children:[s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.jsx("span",{className:"text-header",children:"Products:"}),s.jsx("div",{children:ve.map((n,m)=>s.jsx(Ce,{text:n.label,qty:U(n.value),value:n.value,active:y,onClick:()=>{console.log(n.value),l&&(h([]),l(n.value)),D(n.value),S.setCurrentPage(0)}},`filter-${m}`))})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3 md:gap-x-6 xl:grid-cols-6",children:[s.jsx(N,{options:Pe,value:d.stockStatus,placeholder:"Stock Status",onChange:n=>P(n,"stockStatus")}),s.jsx(N,{options:b,value:d.product_categories,placeholder:"Product Category",onChange:n=>P(n,"product_categories")}),s.jsx(N,{options:we,value:d.productSeller,placeholder:"Product Seller",onChange:n=>P(n,"productSeller")}),s.jsx(N,{options:le,value:d.brand,placeholder:"Product Brands",onChange:n=>P(n,"brand")}),s.jsx(N,{options:Ne,value:d.additionalOptions,placeholder:"Additional Options",onChange:n=>P(n,"additionalOptions")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{className:"btn btn--secondary !gap-[5px]",onClick:L,children:["Apply ",s.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),s.jsx("button",{className:"btn btn--outline blue !h-[44px]",onClick:k,children:"Clear"})]})]}),s.jsxs("div",{className:"flex flex-col-reverse gap-4 mt-4 mb-5 md:flex-row md:justify-between md:items-end md:mt-5 md:mb-6",children:[s.jsxs("p",{children:["View products: ",S.showingOf()]}),s.jsx("div",{children:s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{disabled:ce,className:"btn btn--outline red !gap-[5px]",onClick:K,children:[I?s.jsx(_e,{radius:30}):"Apply Action",s.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),s.jsx("div",{className:"md:min-w-[280px]",children:s.jsx(N,{options:z,value:C,placeholder:"Select Action",onChange:n=>{_(n)}})})]})})]}),s.jsxs("div",{className:"flex flex-1 flex-col gap-[22px]",children:[f>=768?s.jsx(Je,{columns:Ue,dataSource:S.currentItems(),rowKey:n=>n._id,locale:{emptyText:s.jsx(Te,{text:"No products found"})},rowSelection:{type:"checkbox",selectedRowKeys:v,onChange:re},pagination:!1}):s.jsx("div",{className:"flex flex-col gap-5",children:S.currentItems().map((n,m)=>s.jsx(ae,{product:n,handleCollapse:ne,activeCollapse:E},`product-${m}`))}),S.maxPage>1&&s.jsx(Re,{pagination:S})]})]})},jt=()=>{const e=W(Oe),[t,a]=p.useState(""),[r,i]=p.useState([]),[l,o]=p.useState({}),[c,x]=p.useState({}),[f,b]=p.useState({product_shop:e==null?void 0:e._id,limit:R,page:1}),[w,{isLoading:v,error:h}]=ke(),y=async()=>{var C;const d=await w(f),u=d==null?void 0:d.data;if(u){const{countAll:_,totalCount:E,totalPages:O,limit:U,page:P,isDelete:L,isPublished:B,isDraft:I}=u==null?void 0:u.metadata,G=(C=u==null?void 0:u.metadata)==null?void 0:C.products,M={countAll:_,totalCount:E,totalPages:O,limit:U,page:P};x({isDelete:L,isPublished:B,isDraft:I}),o(M),i(G.map(k=>{const V=k.isDelete?"trash":k.isPublished?"publish":"draft";return{...k,status:V}}))}};p.useEffect(()=>{f.product_shop&&y()},[f]),p.useEffect(()=>{b({product_shop:e==null?void 0:e._id,limit:R,page:1})},[e]);const D=r.map(d=>Object.entries(d).map(([C,_])=>_));return s.jsxs(s.Fragment,{children:[s.jsx(me,{isFetching:v,cb_refetch:y,title:"Products Management"}),s.jsxs("div",{className:"flex flex-col-reverse gap-4 mb-5 md:flex-col lg:flex-row lg:justify-between",children:[s.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:gap-[14px]",children:[s.jsxs("button",{className:"btn btn--primary",children:["Add new product ",s.jsx("i",{className:"icon-circle-plus-regular"})]}),s.jsxs(We,{className:"btn btn--outline blue !h-[44px]",data:D,children:["Export CSV ",s.jsx("i",{className:"icon-file-export-solid"})]})]}),s.jsx(Ae,{query:t,setQuery:a,cb_setParamsSearch:()=>{b(d=>({...d,page:1,keyword:t}))},wrapperClass:"lg:w-[326px]",placeholder:"Search Product"})]}),s.jsx(Xe,{cb_onGetProductsByShop:y,cb_setParamsPage:d=>{b(u=>({...u,...d}))},cb_setParamsStatus:d=>{const u={all:{},trash:{isDelete:!0},publish:{isDelete:!1,isPublished:!0},draft:{isDelete:!1,isPublished:!1}};b({product_shop:e==null?void 0:e._id,limit:R,page:1,...u[d]})},cb_setParamsFilter:d=>{b(u=>({...u,page:1,...d}))},products:r,options:l,status:c,userInfo:e})]})};export{jt as default};
