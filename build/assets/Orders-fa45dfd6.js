import{j as e,P as y,C as pe}from"./mui-8cc0f558.js";import{T as re,r as d,p as L}from"./antd-18c18a77.js";import{P as ue}from"./PageHeader-59f437ee.js";import{C as ge}from"./CalendarSelector-438d24a8.js";import{S as Y}from"./index-8ff131fc.js";import{S as z,_ as he,a as X,u as fe,Y as je,o as q,h as _e,k as G,n as ve,Z,p as be,q as M,$ as Ne,a0 as $}from"./index-4d12ff39.js";import{L as V}from"./LabeledProgressBar-8d022fd0.js";import{C as ye}from"./Counter-c89ef878.js";import{S as B}from"./SubmenuTrigger-a96777a5.js";import{P as Pe}from"./Pagination-2bfb5f72.js";import{R as W}from"./RatingStars-d04333c9.js";import{d as J}from"./helpers-3f7c7201.js";import{E as Se}from"./Empty-c0fa71aa.js";import{u as we}from"./usePagination-0eed2831.js";import{f as Ce}from"./commonFunction-8aed5932.js";import"./DocumentTitle-53b49d61.js";import"./index-07b1f494.js";import"./ProgressBar-1829307b.js";var P=256,Q=[],H=256,T;for(;P--;)Q[P]=(P+256).toString(16).substring(1);function De(s){var x=0,m=s||11;if(!T||P+m>H*2)for(T="",P=0;x<H;x++)T+=Q[Math.random()*256|0];return T.substring(P,P+++m)}const Re=()=>e.jsxs(z,{className:"card flex flex-col gap-4",children:[e.jsx("h5",{children:"Average Rate (%)"}),e.jsxs("div",{className:"flex flex-col gap-2.5",children:[e.jsx(V,{color:"header",label:"Product Views",value:87,displayValue:"87%"}),e.jsx(V,{color:"header",label:"Cart Abandonment Rate",value:23,displayValue:"23%"})]})]}),I=({icon:s,color:x="accent",title:m="Lorem ipsum",count:r=0})=>e.jsxs(z,{className:"card !pb-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"badge-icon badge-icon--sm",style:{backgroundColor:`var(--${x})`},children:s}),e.jsx(B,{})]}),e.jsxs("h6",{className:"mt-[28px] mb-2.5",children:[e.jsx("span",{className:"xl:hidden 2xl:inline",children:"Orders "}),m]}),e.jsx(ye,{className:"h3",num:r})]});I.propTypes={icon:y.node,color:y.oneOf(["accent","green","red","badge-status-bg"]),title:y.string,count:y.number};const Oe=he(re).withConfig({displayName:"styles__StyledTable",componentId:"sc-gvbfgj-0"})(["margin-bottom:30px;flex-grow:1;.ant-table{padding:0 26px;}.ant-table-thead .ant-table-cell{padding:33px 0 28px !important;background:var(--widget);&:last-child{text-align:right;}}.ant-table-row:last-child .ant-table-cell{border-bottom:0;}.ant-table-row .ant-table-cell{padding:32px 0;}.ant-table-cell{border-color:var(--input-border) !important;}@media (min-width:1536px){.product-cell{width:23%;}}"]),ee=({order:s,activeCollapse:x,handleCollapse:m,categories:r,cb_onPayOrder:_})=>{var O,f,w,C,A,v,a;const g=X().width<375,{product_categories:S,isDelivered:c,isPaid:h,_id:u}=s,R=(s==null?void 0:s.payment.totalAmountPay)===(s==null?void 0:s.payment.received)?"Fully paid":(s==null?void 0:s.payment.totalAmountPay)>(s==null?void 0:s.payment.received)&&(s==null?void 0:s.payment.received)!==0?"Partially paid":"Unpaid",p=t=>r.find(n=>n.value===t);return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"subheading-2",children:["#",s==null?void 0:s._id]}),e.jsxs("div",{className:"flex items-center gap-4",children:[h&&!c&&e.jsx("div",{className:"cursor__pointer fw600 shadow__orangered",onClick:()=>{_&&_(u)},children:"Delivery"}),e.jsx("button",{className:`collapse-btn ${x===(s==null?void 0:s.SKU)?"active":""}`,"aria-label":"Toggle view",onClick:()=>m(s==null?void 0:s.SKU),children:e.jsx("i",{className:"icon icon-caret-down-solid"})}),e.jsx(B,{})]})]}),e.jsx(pe,{in:x===(s==null?void 0:s.SKU),children:e.jsx("table",{className:"basic-table",children:e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:"Product"})}),e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"img-wrapper w-[70px] h-[64px] flex items-center justify-center",children:e.jsx("img",{src:((O=s==null?void 0:s.product)==null?void 0:O.product_thumb_small)??((f=s==null?void 0:s.product)==null?void 0:f.product_thumb),alt:(w=s==null?void 0:s.product)==null?void 0:w.name})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h5",{className:"text-sm mb-1.5",children:(C=s==null?void 0:s.product)==null?void 0:C.name}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-body-text",children:[e.jsxs("p",{children:["Regular price: $",(A=s==null?void 0:s.product)==null?void 0:A.product_original_price]}),((v=s==null?void 0:s.product)==null?void 0:v.product_original_price)&&e.jsxs("p",{children:["Sale price: $",(a=s==null?void 0:s.product)==null?void 0:a.product_price]})]})]})]})})}),e.jsxs("tr",{children:[e.jsx("td",{children:"SKU"}),e.jsx("td",{children:s==null?void 0:s.SKU})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Category"}),e.jsx("td",{children:S.map((t,n)=>{var i;return e.jsx("span",{className:"label-text capitalize",children:((i=p(t))==null?void 0:i.label)+" "},n)})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Payment"}),e.jsx("td",{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-heading font-bold text-header",children:[R!=="Fully paid"&&`$${s==null?void 0:s.payment.received} / from `,"$",s==null?void 0:s.payment.totalAmountPay]}),e.jsx("span",{children:R})]})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Status"}),e.jsx("td",{className:"capitalize",children:g?s==null?void 0:s.status:e.jsx("span",{className:"badge-status badge-status--lg",style:{backgroundColor:`var(--${J(s==null?void 0:s.status)})`,width:"100%"},children:s==null?void 0:s.status})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Rate"}),e.jsx("td",{children:g?s==null?void 0:s.product_ratings:e.jsx("div",{className:"flex justify-center",children:e.jsx(W,{rating:s==null?void 0:s.product_ratings})})})]})]})})})]})};ee.propTypes={order:y.object.isRequired,activeCollapse:y.string.isRequired,handleCollapse:y.func.isRequired};const Ae=({category:s,sort:x,ordersProduct:m,categories:r,cb_onGetOrdersByShop:_})=>{const g=fe(),{width:S}=X(),[c,h]=d.useState(""),u=s.value==="all"?m:m.filter(a=>a==null?void 0:a.product_categories.includes(s.value)),p=we({data:(()=>{switch(x.value){default:case"default":return u;case"a-z":return u.sort((a,t)=>{var n,i;return(i=a.product)==null?void 0:i.product_name.localeCompare((n=t.product)==null?void 0:n.product_name)});case"z-a":return u.sort((a,t)=>{var n,i;return(i=t.product)==null?void 0:i.product_name.localeCompare((n=a.product)==null?void 0:n.product_name)});case"rating-high-to-low":return u.sort((a,t)=>t.product_ratings-a.product_ratings);case"rating-low-to-high":return u.sort((a,t)=>a.product_ratings-t.product_ratings)}})(),limit:5});d.useEffect(()=>{p.goToPage(0),h("")},[s,x]),d.useEffect(()=>{h("")},[p.currentPage,S]);const O=a=>{h(c===a?"":a)},f=a=>r.find(t=>t.value===a),w=[{title:"# order",dataIndex:"_id",width:"100px",render:a=>e.jsxs("div",{className:"subheading-2 w80px line__clamp__2",children:["#",a]})},{title:"Product",dataIndex:"product",className:"product-cell",render:a=>e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"img-wrapper w-[70px] h-[64px] flex items-center justify-center shrink-0",children:e.jsx("img",{src:(a==null?void 0:a.product_thumb_small)??(a==null?void 0:a.product_thumb),alt:a==null?void 0:a.product_name})}),e.jsxs("div",{className:"flex-col hidden 2xl:flex",children:[e.jsx("h5",{className:"text-sm max-w-[195px] mb-1.5 line__clamp__2",children:a==null?void 0:a.product_name}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsxs("p",{children:["Regular price: $",a==null?void 0:a.product_original_price]}),(a==null?void 0:a.product_original_price)&&e.jsxs("p",{children:["Sale price: $",a==null?void 0:a.product_price]})]})]})]}),responsive:["lg"]},{title:"Category",dataIndex:"product_categories",align:"center",render:a=>e.jsx("div",{className:"flex items-center gap-4 direction__column",children:a.map((t,n)=>{var i,b,N;return e.jsxs("div",{className:"flex items-center gap-4 ",children:[e.jsx("div",{className:`badge-icon badge-icon--sm bg-${(i=f(t))==null?void 0:i.color}`,children:e.jsx("i",{className:`${(b=f(t))==null?void 0:b.icon} text-base`})}),e.jsx("span",{className:"label-text capitalize",children:(N=f(t))==null?void 0:N.label})]},n)})}),responsive:["lg"]},{title:"Payment",dataIndex:"payment",render:a=>{const t=a.totalAmountPay===a.received?"Fully paid":a.totalAmountPay>a.received&&a.received!==0?"Partially paid":"Unpaid";return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-heading font-bold text-header",children:[t!=="Fully paid"&&`$${a.received} / from `,"$",Ce(a.totalAmountPay)]}),e.jsx("span",{children:t})]})}},{title:"Order Status",dataIndex:"status",render:a=>e.jsx("span",{className:"badge-status badge-status--lg",style:{backgroundColor:`var(--${J(a)})`},children:a})},{title:"Rate",dataIndex:"product_ratings",render:a=>e.jsx(W,{rating:a}),responsive:["xl"]},{title:"Date",dataIndex:"createdAt",render:a=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:"Created At:"}),e.jsx("span",{className:"font-bold text-header",children:a&&L(a).format("DD/MM/YYYY")})]}),responsive:["xl"]},{title:"Actions",dataIndex:"actions",width:"70px",align:"center",render:(a,t)=>{const{isDelivered:n,isPaid:i}=t;return e.jsxs("div",{className:"flex items-center justify-end gap-11",children:[i&&!n&&e.jsx("div",{className:"cursor__pointer fw600 shadow__orangered",onClick:()=>{v({orderId:t==null?void 0:t._id})},children:"Delivery"}),e.jsx(B,{})]})}}],[C,{isLoading:A}]=je(),v=async a=>{await C(a).then(t=>{var i,b;if(t==null?void 0:t.data)_&&_(),g(q({isOpen:Date.now(),content:"Delivered Order Success",step:1}));else{const N=((b=(i=t==null?void 0:t.error)==null?void 0:i.data)==null?void 0:b.message)??"";g(q({isOpen:Date.now(),content:N||"Deliver Order Failed",step:2}))}}).catch(t=>console.log(t))};return e.jsxs(z,{className:"flex flex-col flex-1 w-full",children:[S>=768?e.jsx(Oe,{columns:w,dataSource:p.currentItems(),pagination:!1,locale:{emptyText:e.jsx(Se,{text:"No orders found"})},rowKey:a=>a.SKU}):e.jsx("div",{className:"flex flex-1 flex-col gap-5 mb-[26px]",children:p.currentItems().map(a=>e.jsx(ee,{order:a,activeCollapse:c,handleCollapse:O,categories:r,cb_onPayOrder:t=>{v({orderId:t})}},a==null?void 0:a.SKU))}),p.maxPage>1&&e.jsx(Pe,{pagination:p})]})},We=()=>{const{t:s}=_e(),x=G(ve),m=[{value:"all",label:"All Products"},...x],[r,_]=d.useState(m[0]),[g,S]=d.useState(Z[0]),c=G(be),[h,u]=d.useState(0),[R,p]=d.useState(0),[O,f]=d.useState(0),[w,C]=d.useState(0),[A,v]=d.useState(0),[a,t]=d.useState([]),[n,i]=d.useState({shopId:c==null?void 0:c._id,limit:M,page:1});d.useEffect(()=>{i({shopId:c==null?void 0:c._id,limit:M,page:1})},[c]);const[b,{isLoading:N,error:Ie}]=Ne(),k=async()=>{await b(n).then(j=>{const D=j==null?void 0:j.data;if(D){const{isPaid:se,isDelivered:ae,isCanceled:te,isRefunded:le,isNotPaid:ie,orders:F}=D==null?void 0:D.metadata;u(se),p(ae),f(te),C(le),v(ie);const ne=F.flatMap(l=>l==null?void 0:l.itemProducts),ce=({isPaid:l,isDelivered:E,isCanceled:o,isRefunded:U})=>U===!0?"refunded":o===!0?"cancelled":E===!0?"Delivered":l===!1?"not pay":l===!0&&E===!1?"paid":"completed",de=ne.map((l,E)=>{const o=F.find(K=>(K==null?void 0:K._id)===(l==null?void 0:l.order_id)),{isPaid:U,isDelivered:xe,isCanceled:oe,isRefunded:me}=o;return{...o,product_id:l==null?void 0:l._id,product_ratings:l==null?void 0:l.product_ratings,product_type:l==null?void 0:l.product_type,product_categories:l==null?void 0:l.product_categories,payment:{totalAmountPay:o==null?void 0:o.totalAmountPay,received:o!=null&&o.isPaid?o==null?void 0:o.totalAmountPay:0},status:ce({isPaid:U,isDelivered:xe,isCanceled:oe,isRefunded:me}),SKU:De()+E,product:l}});t(de)}}).catch(j=>console.log(j))};return d.useEffect(()=>{n.shopId&&k()},[n]),e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:s("Orders"),isFetching:N,cb_refetch:k}),e.jsxs("div",{className:"flex flex-col flex-1 gap-5 md:gap-[26px]",children:[e.jsxs("div",{className:`w-full grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-[26px] lg:grid-cols-4 lg:items-end
                     xl:grid-cols-6`,children:[e.jsx(ge,{wrapperClass:"lg:max-w-[275px] lg:col-span-2 xl:col-span-4",id:"ordersPeriodSelector",cb_setRangeDate:j=>{const D={gte:L(j[0]).format(),lt:L(j[1]).format()};i({shopId:c==null?void 0:c._id,limit:M,page:1,createdAt:D})}}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-[26px] md:col-span-2",children:[e.jsx(Y,{value:r,options:m,onChange:_,placeholder:"Product category"}),e.jsx(Y,{value:g,options:Z,onChange:S,placeholder:"Default sorting"})]})]}),e.jsxs("div",{className:"w-full widgets-grid grid-cols-1 xl:grid-cols-6",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsx(Re,{})}),e.jsxs("div",{className:"widgets-grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:col-span-4",children:[e.jsx(I,{title:"Not Paid",count:A*$,color:"red",icon:e.jsx("i",{className:"icon-ban-solid"})}),e.jsx(I,{title:"Paid",count:h*$,icon:e.jsx("i",{className:"icon-check-to-slot-solid"})}),e.jsx(I,{title:"Delivered",count:R*$,color:"green",icon:e.jsx("i",{className:"icon-list-check-solid"})}),e.jsx(I,{title:"Refunded",count:w*$,color:"badge-status-bg",icon:e.jsx("i",{className:"icon-rotate-left-solid"})})]})]}),e.jsx(Ae,{ordersProduct:a,category:r,sort:g,categories:x,cb_onGetOrdersByShop:k})]})]})};export{We as default};
