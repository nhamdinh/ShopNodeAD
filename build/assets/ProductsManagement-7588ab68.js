var ce=Object.defineProperty;var de=(e,t,a)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var A=(e,t,a)=>(de(e,typeof t!="symbol"?t+"":t,a),a);import{p as j,j as s,P as q,C as pe}from"./mui-2493782d.js";import{P as ue}from"./PageHeader-f589027d.js";import{_ as me,g as he,v as xe,u as ge,a as fe,r as be,w as R,x as ye,y as je,F as Se,z as ve,P as V,B as Ce,C as Pe,s as _e,D as z,o as H,i as we,n as Ne,q as Oe,E as ke}from"./index-88527f4e.js";import{h as W,T as Ae,C as Ee,r as u}from"./antd-1d728b6a.js";import{S as N}from"./index-d2873610.js";import{E as Te}from"./Empty-34f26085.js";import{P as Fe}from"./Pagination-94a491c8.js";import{S as Re}from"./SubmenuTrigger-34b58daa.js";import{P as De}from"./columnDefs-c86d613d.js";import{r as Ue}from"./commonFunction-7252a3c4.js";import"./DocumentTitle-62345d26.js";import"./RatingStars-e1771c4e.js";import"./Timestamp-eb25fa85.js";import"./Trend-1bb25368.js";import"./Counter-48b40dab.js";import"./helpers-dbcd4939.js";const Le=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),J=e=>Array.isArray(e)&&e.every(t=>typeof t=="object"&&!(t instanceof Array)),Be=e=>Array.isArray(e)&&e.every(t=>Array.isArray(t)),Ie=e=>Array.from(e.map(t=>Object.keys(t)).reduce((t,a)=>new Set([...t,...a]),[])),Me=(e,t)=>{t=t||Ie(e);let a=t,r=t;J(t)&&(a=t.map(l=>l.label),r=t.map(l=>l.key));const i=e.map(l=>r.map(o=>$e(o,l)));return[a,...i]},$e=(e,t)=>{const a=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(r,i,l,o){const c=r[i];if(c==null)o.splice(1);else return c},t);return a===void 0?e in t?t[e]:"":a},qe=e=>typeof e>"u"||e===null?"":e,Z=(e,t=",",a='"')=>e.filter(r=>r).map(r=>r.map(i=>qe(i)).map(i=>`${a}${i}${a}`).join(t)).join(`
`),Ge=(e,t,a,r)=>Z(t?[t,...e]:e,a,r),Ke=(e,t,a,r)=>Z(Me(e,t),a,r),Ve=(e,t,a,r)=>t?`${t.join(a)}
${e}`:e.replace(/"/g,'""'),X=(e,t,a,r)=>{if(J(e))return Ke(e,t,a,r);if(Be(e))return Ge(e,t,a,r);if(typeof e=="string")return Ve(e,t,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},Y=(e,t,a,r,i)=>{const l=X(e,a,r,i),o=Le()?"application/csv":"text/csv",c=new Blob([t?"\uFEFF":"",l],{type:o}),h=`data:${o};charset=utf-8,${t?"\uFEFF":""}${l}`,x=window.URL||window.webkitURL;return typeof x.createObjectURL>"u"?h:x.createObjectURL(c)},ee={data:j.oneOfType([j.string,j.array,j.func]).isRequired,headers:j.array,target:j.string,separator:j.string,filename:j.string,uFEFF:j.bool,onClick:j.func,asyncOnClick:j.bool,enclosingCharacter:j.string},te={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},ze={target:"_blank"};class Q extends W.Component{constructor(t){super(t),this.state={}}buildURI(){return Y(...arguments)}componentDidMount(){const{data:t,headers:a,separator:r,enclosingCharacter:i,uFEFF:l,target:o,specs:c,replace:h}=this.props;this.state.page=window.open(this.buildURI(t,l,a,r,i),o,c,h)}getWindow(){return this.state.page}render(){return null}}A(Q,"defaultProps",Object.assign(te,ze)),A(Q,"propTypes",ee);var F;let He=(F=class extends W.Component{constructor(t){super(t),this.buildURI=this.buildURI.bind(this)}buildURI(){return Y(...arguments)}handleLegacy(t,a=!1){if(window.navigator.msSaveOrOpenBlob){t.preventDefault();const{data:r,headers:i,separator:l,filename:o,enclosingCharacter:c,uFEFF:h}=this.props,x=a&&typeof r=="function"?r():r;let f=new Blob([h?"\uFEFF":"",X(x,i,l,c)]);return window.navigator.msSaveBlob(f,o),!1}}handleAsyncClick(t){const a=r=>{if(r===!1){t.preventDefault();return}this.handleLegacy(t,!0)};this.props.onClick(t,a)}handleSyncClick(t){if(this.props.onClick(t)===!1){t.preventDefault();return}this.handleLegacy(t)}handleClick(){return t=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(t):this.handleSyncClick(t);this.handleLegacy(t)}}render(){const{data:t,headers:a,separator:r,filename:i,uFEFF:l,children:o,onClick:c,asyncOnClick:h,enclosingCharacter:x,...f}=this.props,S=typeof window>"u"?"":this.buildURI(t,l,a,r,x);return s.jsx("a",{download:i,...f,ref:g=>this.link=g,target:"_self",href:S,onClick:this.handleClick(),children:o})}},A(F,"defaultProps",te),A(F,"propTypes",ee),F);const Qe=He,We=me(Ae).withConfig({displayName:"styles__StyledTable",componentId:"sc-k8b1p0-0"})(["flex-grow:1;.ant-spin-nested-loading,.ant-spin-container{height:100%;}.ant-spin-container{display:flex;flex-direction:column;}.ant-table{flex-grow:1;background:transparent;}.ant-table-thead .ant-table-cell{background:var(--widget);padding:30px 15px 20px !important;border-bottom:1px solid var(--border) !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{text-align:right;padding-right:24px !important;}}.ant-table-tbody .ant-table-cell{border:none !important;padding:30px 15px !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{padding-right:24px !important;}}"]),se=({product:e,activeCollapse:t,handleCollapse:a})=>{const r=e.product_quantity;return s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(Ee,{}),s.jsxs("div",{className:"flex items-center gap-2.5",children:[s.jsx("div",{className:"img-wrapper w-[40px] h-[40px] flex items-center justify-center",children:s.jsx("img",{src:(e==null?void 0:e.product_thumb_small)??(e==null?void 0:e.product_thumb),alt:"product"})}),s.jsx("h6",{className:"text-sm max-w-[70px] truncate",children:e.product_sku})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:`collapse-btn ${t===e._id?"active":""}`,"aria-label":"Toggle view",onClick:()=>a(e._id),children:s.jsx("i",{className:"icon icon-caret-down-solid"})}),s.jsx(he,{to:"/product-editor","aria-label":"Edit",children:s.jsx("i",{className:"icon icon-pen-to-square-regular"})}),s.jsx(Re,{})]})]}),s.jsx(pe,{in:t===e._id,children:s.jsx("table",{className:"basic-table",children:s.jsxs("tbody",{children:[s.jsx("tr",{children:s.jsx("td",{colSpan:2,children:"Product"})}),s.jsx("tr",{children:s.jsx("td",{colSpan:2,children:s.jsxs("div",{className:"flex gap-2.5",children:[s.jsx("div",{className:"img-wrapper w-[45px] h-[45px] flex items-center justify-center",children:s.jsx("img",{src:(e==null?void 0:e.product_thumb_small)??(e==null?void 0:e.product_thumb),alt:"product"})}),s.jsx("h6",{className:"text-sm max-w-[155px]",children:e.product_name})]})})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["SKU: ",e.product_sku]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Stock status:",r==null?"On Demand":s.jsxs("span",{children:[s.jsx("span",{className:`${r!==0?"text-green":"text-red"}`,children:r!==0?r>=xe?"In stock ":"Low Inventory ":"Out of stock "}),"(",r,")"]})]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Price: $",e.product_price]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Category:",s.jsx("button",{className:"capitalize text-accent ml-1",children:e.product_type})]})})]})})})]})};se.propTypes={product:q.object.isRequired,activeCollapse:q.string.isRequired,handleCollapse:q.func.isRequired};const Je=({data:e,limit:t=10,totalPages:a,totalCount:r})=>{const[i,l]=u.useState(0),o=r??e.length,c=a??Math.ceil(e.length/t),h=()=>e;return u.useEffect(()=>{i>c-1?l(c-1):i<0&&c>0&&l(0)},[h()]),{next:()=>{l(g=>Math.min(g+1,c))},prev:()=>{l(g=>Math.max(g-1,0))},goToPage:g=>{const v=Math.max(0,g);l(()=>Math.min(v,c))},showingOf:()=>{const g=i*t,v=o>t?g+t:o;return o>0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"font-semibold",children:v}),"/",o]}):""},currentItems:h,currentPage:i,setCurrentPage:l,maxPage:c}},Ze=({products:e=[],options:t,status:a,userInfo:r,cb_setParamsPage:i,cb_setParamsStatus:l,cb_setParamsFilter:o,cb_onGetProductsByShop:c})=>{const h=ge(),{width:x}=fe(),f={stockStatus:null,product_type:null,productSeller:null,productBrands:null,additionalOptions:null},[P,S]=u.useState([]),[g,v]=u.useState("all"),[C,m]=u.useState(f),[p,O]=u.useState(null),[w,k]=u.useState(""),D=n=>({all:(t==null?void 0:t.countAll)??e.length,trash:(a==null?void 0:a.isDelete)??0,publish:(a==null?void 0:a.isPublished)??0,draft:(a==null?void 0:a.isDraft)??0})[n]??0,_=({value:n,label:d},y)=>{m($=>({...$,[y]:{label:d,value:n}}))},U=()=>{const n=Ue(C),d={};Object.keys(n).forEach(y=>{y==="product_type"&&(d[y]=n[y].value)}),console.log(d),o&&(o(d),S([]),b.setCurrentPage(0))},[L,{isLoading:B,error:G}]=be(),I=async n=>{const d=await L(n),y=d==null?void 0:d.data;y!=null&&y.metadata?(c&&c(),S([]),h(H({isOpen:Date.now(),content:"Updated Success",step:1}))):h(H({isOpen:Date.now(),content:"Update Failed",step:2}))},M=()=>{var y;const n=(y=z.find($=>$.value===p.value))==null?void 0:y.bodyUpdate,d={ids:P,bodyUpdate:n,product_shop:r==null?void 0:r._id};I(d)},K=()=>{m(f)},b=Je({...t,data:(()=>g==="all"?e:e.filter(n=>n.status===g))(),limit:R});u.useEffect(()=>{k(""),i&&(S([]),i({page:+b.currentPage>0?+b.currentPage+1:1}))},[b.currentPage,x]);const ae=n=>{k(w===n?"":n)},ne=n=>{S(n)};u.useState("All");const[re,le]=u.useState([]),{data:T,error:Xe,isSuccess:ie,isLoading:Ye}=ye({page:1,limit:1e3},{refetchOnMountOrArgChange:!0,skip:!1});u.useEffect(()=>{ie&&le(T==null?void 0:T.brands.map(n=>({value:n._id,label:n.brand})))},[T]);const oe=P.length===0||!p;return s.jsxs("div",{className:"flex flex-col flex-1",children:[s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.jsx("span",{className:"text-header",children:"Products:"}),s.jsx("div",{children:je.map((n,d)=>s.jsx(Se,{text:n.label,qty:D(n.value),value:n.value,active:g,onClick:()=>{l&&(S([]),l(n.value)),v(n.value),b.setCurrentPage(0)}},`filter-${d}`))})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3 md:gap-x-6 xl:grid-cols-6",children:[s.jsx(N,{options:ve,value:C.stockStatus,placeholder:"Stock Status",onChange:n=>_(n,"stockStatus")}),s.jsx(N,{options:V.filter(n=>{var d;return n.value!==((d=V[0])==null?void 0:d.value)}),value:C.product_type,placeholder:"Product Category",onChange:n=>_(n,"product_type")}),s.jsx(N,{options:Ce,value:C.productSeller,placeholder:"Product Seller",onChange:n=>_(n,"productSeller")}),s.jsx(N,{options:re,value:C.productBrands,placeholder:"Product Brands",onChange:n=>_(n,"productBrands")}),s.jsx(N,{options:Pe,value:C.additionalOptions,placeholder:"Additional Options",onChange:n=>_(n,"additionalOptions")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{className:"btn btn--secondary !gap-[5px]",onClick:U,children:["Apply ",s.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),s.jsx("button",{className:"btn btn--outline blue !h-[44px]",onClick:K,children:"Clear"})]})]}),s.jsxs("div",{className:"flex flex-col-reverse gap-4 mt-4 mb-5 md:flex-row md:justify-between md:items-end md:mt-5 md:mb-6",children:[s.jsxs("p",{children:["View products: ",b.showingOf()]}),s.jsx("div",{children:s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{disabled:oe,className:"btn btn--outline red !gap-[5px]",onClick:M,children:[B?s.jsx(_e,{radius:30}):"Apply Action",s.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),s.jsx("div",{className:"md:min-w-[280px]",children:s.jsx(N,{options:z,value:p,placeholder:"Select Action",onChange:n=>{O(n)}})})]})})]}),s.jsxs("div",{className:"flex flex-1 flex-col gap-[22px]",children:[x>=768?s.jsx(We,{columns:De,dataSource:b.currentItems(),rowKey:n=>n._id,locale:{emptyText:s.jsx(Te,{text:"No products found"})},rowSelection:{type:"checkbox",selectedRowKeys:P,onChange:ne},pagination:!1}):s.jsx("div",{className:"flex flex-col gap-5",children:b.currentItems().map((n,d)=>s.jsx(se,{product:n,handleCollapse:ae,activeCollapse:w},`product-${d}`))}),b.maxPage>1&&s.jsx(Fe,{pagination:b})]})]})},bt=()=>{const e=we(Ne),[t,a]=u.useState(""),[r,i]=u.useState([]),[l,o]=u.useState({}),[c,h]=u.useState({}),[x,f]=u.useState({product_shop:e==null?void 0:e._id,limit:R,page:1}),[P,{isLoading:S,error:g}]=Oe(),v=async()=>{var O;const m=await P(x),p=m==null?void 0:m.data;if(p){const{countAll:w,totalCount:k,totalPages:D,limit:_,page:U,isDelete:L,isPublished:B,isDraft:G}=p==null?void 0:p.metadata,I=(O=p==null?void 0:p.metadata)==null?void 0:O.products,M={countAll:w,totalCount:k,totalPages:D,limit:_,page:U};h({isDelete:L,isPublished:B,isDraft:G}),o(M),i(I.map(E=>{const b=E.isDelete?"trash":E.isPublished?"publish":"draft";return{...E,status:b}}))}};u.useEffect(()=>{x.product_shop&&v()},[x]),u.useEffect(()=>{f({product_shop:e==null?void 0:e._id,limit:R,page:1})},[e]);const C=r.map(m=>Object.entries(m).map(([O,w])=>w));return s.jsxs(s.Fragment,{children:[s.jsx(ue,{isFetching:S,cb_refetch:v,title:"Products Management"}),s.jsxs("div",{className:"flex flex-col-reverse gap-4 mb-5 md:flex-col lg:flex-row lg:justify-between",children:[s.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:gap-[14px]",children:[s.jsxs("button",{className:"btn btn--primary",children:["Add new product ",s.jsx("i",{className:"icon-circle-plus-regular"})]}),s.jsxs(Qe,{className:"btn btn--outline blue !h-[44px]",data:C,children:["Export CSV ",s.jsx("i",{className:"icon-file-export-solid"})]})]}),s.jsx(ke,{query:t,setQuery:a,cb_setParamsSearch:()=>{f(m=>({...m,page:1,keyword:t}))},wrapperClass:"lg:w-[326px]",placeholder:"Search Product"})]}),s.jsx(Ze,{cb_onGetProductsByShop:v,cb_setParamsPage:m=>{f(p=>({...p,...m}))},cb_setParamsStatus:m=>{const p={all:{},trash:{isDelete:!0},publish:{isDelete:!1,isPublished:!0},draft:{isDelete:!1,isPublished:!1}};f({product_shop:e==null?void 0:e._id,limit:R,page:1,...p[m]})},cb_setParamsFilter:m=>{f(p=>({...p,page:1,...m}))},products:r,options:l,status:c,userInfo:e})]})};export{bt as default};
