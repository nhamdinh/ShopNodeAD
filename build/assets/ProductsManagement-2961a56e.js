var de=Object.defineProperty;var pe=(s,e,a)=>e in s?de(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a;var A=(s,e,a)=>(pe(s,typeof e!="symbol"?e+"":e,a),a);import{p as g,j as t,P as G,C as ue}from"./mui-8cc0f558.js";import{P as me}from"./PageHeader-39c77a7f.js";import{_ as he,g as xe,x as ge,u as fe,a as be,k as W,n as ye,v as je,y as U,z as Se,B as ve,F as Ce,C as _e,D as we,E as Ne,w as Pe,G as H,o as z,h as Oe,p as ke,r as Ae,H as Ee}from"./index-5a88363d.js";import{h as J,T as Fe,C as Te,r as d}from"./antd-18c18a77.js";import{S as N}from"./index-92d70eeb.js";import{E as Re}from"./Empty-4468ae25.js";import{P as Ue}from"./Pagination-2bfb5f72.js";import{S as De}from"./SubmenuTrigger-a96777a5.js";import{u as Le}from"./usePaginationApi-88bb9964.js";import{P as Be}from"./columnDefs-3d65b5ba.js";import{r as Ie}from"./commonFunction-3656b39b.js";import"./DocumentTitle-53b49d61.js";import"./RatingStars-5f12d36a.js";import"./Timestamp-d79ab090.js";import"./Trend-9191d14d.js";import"./Counter-f6fae9cb.js";import"./helpers-8c6e04da.js";const $e=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Z=s=>Array.isArray(s)&&s.every(e=>typeof e=="object"&&!(e instanceof Array)),Me=s=>Array.isArray(s)&&s.every(e=>Array.isArray(e)),qe=s=>Array.from(s.map(e=>Object.keys(e)).reduce((e,a)=>new Set([...e,...a]),[])),Ge=(s,e)=>{e=e||qe(s);let a=e,r=e;Z(e)&&(a=e.map(l=>l.label),r=e.map(l=>l.key));const i=s.map(l=>r.map(c=>Ke(c,l)));return[a,...i]},Ke=(s,e)=>{const a=s.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(r,i,l,c){const m=r[i];if(m==null)c.splice(1);else return m},e);return a===void 0?s in e?e[s]:"":a},Ve=s=>typeof s>"u"||s===null?"":s,X=(s,e=",",a='"')=>s.filter(r=>r).map(r=>r.map(i=>Ve(i)).map(i=>`${a}${i}${a}`).join(e)).join(`
`),He=(s,e,a,r)=>X(e?[e,...s]:s,a,r),ze=(s,e,a,r)=>X(Ge(s,e),a,r),Qe=(s,e,a,r)=>e?`${e.join(a)}
${s}`:s.replace(/"/g,'""'),Y=(s,e,a,r)=>{if(Z(s))return ze(s,e,a,r);if(Me(s))return He(s,e,a,r);if(typeof s=="string")return Qe(s,e,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},ee=(s,e,a,r,i)=>{const l=Y(s,a,r,i),c=$e()?"application/csv":"text/csv",m=new Blob([e?"\uFEFF":"",l],{type:c}),f=`data:${c};charset=utf-8,${e?"\uFEFF":""}${l}`,b=window.URL||window.webkitURL;return typeof b.createObjectURL>"u"?f:b.createObjectURL(m)},te={data:g.oneOfType([g.string,g.array,g.func]).isRequired,headers:g.array,target:g.string,separator:g.string,filename:g.string,uFEFF:g.bool,onClick:g.func,asyncOnClick:g.bool,enclosingCharacter:g.string},se={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},We={target:"_blank"};class Q extends J.Component{constructor(e){super(e),this.state={}}buildURI(){return ee(...arguments)}componentDidMount(){const{data:e,headers:a,separator:r,enclosingCharacter:i,uFEFF:l,target:c,specs:m,replace:f}=this.props;this.state.page=window.open(this.buildURI(e,l,a,r,i),c,m,f)}getWindow(){return this.state.page}render(){return null}}A(Q,"defaultProps",Object.assign(se,We)),A(Q,"propTypes",te);var R;let Je=(R=class extends J.Component{constructor(e){super(e),this.buildURI=this.buildURI.bind(this)}buildURI(){return ee(...arguments)}handleLegacy(e,a=!1){if(window.navigator.msSaveOrOpenBlob){e.preventDefault();const{data:r,headers:i,separator:l,filename:c,enclosingCharacter:m,uFEFF:f}=this.props,b=a&&typeof r=="function"?r():r;let y=new Blob([f?"\uFEFF":"",Y(b,i,l,m)]);return window.navigator.msSaveBlob(y,c),!1}}handleAsyncClick(e){const a=r=>{if(r===!1){e.preventDefault();return}this.handleLegacy(e,!0)};this.props.onClick(e,a)}handleSyncClick(e){if(this.props.onClick(e)===!1){e.preventDefault();return}this.handleLegacy(e)}handleClick(){return e=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(e):this.handleSyncClick(e);this.handleLegacy(e)}}render(){const{data:e,headers:a,separator:r,filename:i,uFEFF:l,children:c,onClick:m,asyncOnClick:f,enclosingCharacter:b,...y}=this.props,C=typeof window>"u"?"":this.buildURI(e,l,a,r,b);return t.jsx("a",{download:i,...y,ref:S=>this.link=S,target:"_self",href:C,onClick:this.handleClick(),children:c})}},A(R,"defaultProps",se),A(R,"propTypes",te),R);const Ze=Je,Xe=he(Fe).withConfig({displayName:"styles__StyledTable",componentId:"sc-k8b1p0-0"})(["flex-grow:1;.ant-spin-nested-loading,.ant-spin-container{height:100%;}.ant-spin-container{display:flex;flex-direction:column;}.ant-table{flex-grow:1;background:transparent;}.ant-table-thead .ant-table-cell{background:var(--widget);padding:30px 15px 20px !important;border-bottom:1px solid var(--border) !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{text-align:right;padding-right:24px !important;}}.ant-table-tbody .ant-table-cell{border:none !important;padding:30px 15px !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{padding-right:24px !important;}}"]),ae=({product:s,activeCollapse:e,handleCollapse:a})=>{const r=s.product_quantity;return t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(Te,{}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"img-wrapper w-[40px] h-[40px] flex items-center justify-center",children:t.jsx("img",{src:(s==null?void 0:s.product_thumb_small)??(s==null?void 0:s.product_thumb),alt:"product"})}),t.jsx("h6",{className:"text-sm max-w-[70px] truncate",children:s.product_sku})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{className:`collapse-btn ${e===s._id?"active":""}`,"aria-label":"Toggle view",onClick:()=>a(s._id),children:t.jsx("i",{className:"icon icon-caret-down-solid"})}),t.jsx(xe,{to:"/product-editor","aria-label":"Edit",children:t.jsx("i",{className:"icon icon-pen-to-square-regular"})}),t.jsx(De,{})]})]}),t.jsx(ue,{in:e===s._id,children:t.jsx("table",{className:"basic-table",children:t.jsxs("tbody",{children:[t.jsx("tr",{children:t.jsx("td",{colSpan:2,children:"Product"})}),t.jsx("tr",{children:t.jsx("td",{colSpan:2,children:t.jsxs("div",{className:"flex gap-2.5",children:[t.jsx("div",{className:"img-wrapper w-[45px] h-[45px] flex items-center justify-center",children:t.jsx("img",{src:(s==null?void 0:s.product_thumb_small)??(s==null?void 0:s.product_thumb),alt:"product"})}),t.jsx("h6",{className:"text-sm max-w-[155px]",children:s.product_name})]})})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["SKU: ",s.product_sku]})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["Stock status:",r==null?"On Demand":t.jsxs("span",{children:[t.jsx("span",{className:`${r!==0?"text-green":"text-red"}`,children:r!==0?r>=ge?"In stock ":"Low Inventory ":"Out of stock "}),"(",r,")"]})]})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["Price: $",s.product_price]})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["Category:",t.jsx("button",{className:"capitalize text-accent ml-1",children:s.product_type})]})})]})})})]})};ae.propTypes={product:G.object.isRequired,activeCollapse:G.string.isRequired,handleCollapse:G.func.isRequired};const Ye=({products:s=[],options:e,status:a,userInfo:r,cb_setParamsPage:i,cb_setParamsStatus:l,cb_setParamsFilter:c,cb_onGetProductsByShop:m})=>{const f=fe(),{width:b}=be(),y=W(ye),j={stockStatus:null,product_categories:null,productSeller:null,brand:null,additionalOptions:null},[C,S]=d.useState([]),[E,P]=d.useState("all"),[v,p]=d.useState(j),[o,O]=d.useState(null),[w,k]=d.useState(""),D=n=>({all:(e==null?void 0:e.countAll)??s.length,trash:(a==null?void 0:a.isDelete)??0,publish:(a==null?void 0:a.isPublished)??0,draft:(a==null?void 0:a.isDraft)??0})[n]??0,_=({value:n,label:u},h)=>{p(q=>({...q,[h]:{label:u,value:n}}))},L=()=>{const n=Ie(v),u={};Object.keys(n).forEach(h=>{h==="product_categories"&&(u[h]=n[h].value),h==="brand"&&(u[h]=n[h].value)}),c&&(c(u),S([]),x.setCurrentPage(0))},[B,{isLoading:I,error:K}]=je(),$=async n=>{const u=await B(n),h=u==null?void 0:u.data;h!=null&&h.metadata?(m&&m(),S([]),f(z({isOpen:Date.now(),content:"Updated Success",step:1}))):f(z({isOpen:Date.now(),content:"Update Failed",step:2}))},M=()=>{var h;const n=(h=H.find(q=>q.value===o.value))==null?void 0:h.bodyUpdate,u={ids:C,bodyUpdate:n,product_shop:r==null?void 0:r._id};$(u)},V=()=>{p(j)},x=Le({...e,data:(()=>E==="all"?s:s.filter(n=>n.status===E))(),limit:U});d.useEffect(()=>{k("")},[b]),d.useEffect(()=>{i&&(S([]),i({page:+x.currentPage>0?+x.currentPage+1:1}))},[x.currentPage]);const ne=n=>{k(w===n?"":n)},re=n=>{S(n)};d.useState("All");const[ie,le]=d.useState([]),{data:T,error:et,isSuccess:oe,isLoading:tt}=Se({page:1,limit:1e3},{refetchOnMountOrArgChange:!0,skip:!1});d.useEffect(()=>{oe&&le(T==null?void 0:T.brands.map(n=>({value:n._id,label:n.brand})))},[T]);const ce=C.length===0||!o;return t.jsxs("div",{className:"flex flex-col flex-1",children:[t.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.jsx("span",{className:"text-header",children:"Products:"}),t.jsx("div",{children:ve.map((n,u)=>t.jsx(Ce,{text:n.label,qty:D(n.value),value:n.value,active:E,onClick:()=>{console.log(n.value),l&&(S([]),l(n.value)),P(n.value),x.setCurrentPage(0)}},`filter-${u}`))})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3 md:gap-x-6 xl:grid-cols-6",children:[t.jsx(N,{options:_e,value:v.stockStatus,placeholder:"Stock Status",onChange:n=>_(n,"stockStatus")}),t.jsx(N,{options:y,value:v.product_categories,placeholder:"Product Category",onChange:n=>_(n,"product_categories")}),t.jsx(N,{options:we,value:v.productSeller,placeholder:"Product Seller",onChange:n=>_(n,"productSeller")}),t.jsx(N,{options:ie,value:v.brand,placeholder:"Product Brands",onChange:n=>_(n,"brand")}),t.jsx(N,{options:Ne,value:v.additionalOptions,placeholder:"Additional Options",onChange:n=>_(n,"additionalOptions")}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("button",{className:"btn btn--secondary !gap-[5px]",onClick:L,children:["Apply ",t.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),t.jsx("button",{className:"btn btn--outline blue !h-[44px]",onClick:V,children:"Clear"})]})]}),t.jsxs("div",{className:"flex flex-col-reverse gap-4 mt-4 mb-5 md:flex-row md:justify-between md:items-end md:mt-5 md:mb-6",children:[t.jsxs("p",{children:["View products: ",x.showingOf()]}),t.jsx("div",{children:t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("button",{disabled:ce,className:"btn btn--outline red !gap-[5px]",onClick:M,children:[I?t.jsx(Pe,{radius:30}):"Apply Action",t.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),t.jsx("div",{className:"md:min-w-[280px]",children:t.jsx(N,{options:H,value:o,placeholder:"Select Action",onChange:n=>{O(n)}})})]})})]}),t.jsxs("div",{className:"flex flex-1 flex-col gap-[22px]",children:[b>=768?t.jsx(Xe,{columns:Be,dataSource:x.currentItems(),rowKey:n=>n._id,locale:{emptyText:t.jsx(Re,{text:"No products found"})},rowSelection:{type:"checkbox",selectedRowKeys:C,onChange:re},pagination:!1}):t.jsx("div",{className:"flex flex-col gap-5",children:x.currentItems().map((n,u)=>t.jsx(ae,{product:n,handleCollapse:ne,activeCollapse:w},`product-${u}`))}),x.maxPage>1&&t.jsx(Ue,{pagination:x})]})]})},St=()=>{const{t:s}=Oe(),e=W(ke),[a,r]=d.useState(""),[i,l]=d.useState([]),[c,m]=d.useState({}),[f,b]=d.useState({}),[y,j]=d.useState({product_shop:e==null?void 0:e._id,limit:U,page:1}),[C,{isLoading:S,error:E}]=Ae(),P=async()=>{var O;const p=await C(y),o=p==null?void 0:p.data;if(o){const{countAll:w,totalCount:k,totalPages:D,limit:_,page:L,isDelete:B,isPublished:I,isDraft:K}=o==null?void 0:o.metadata,$=(O=o==null?void 0:o.metadata)==null?void 0:O.products,M={countAll:w,totalCount:k,totalPages:D,limit:_,page:L};b({isDelete:B,isPublished:I,isDraft:K}),m(M),l($.map(F=>{const x=F.isDelete?"trash":F.isPublished?"publish":"draft";return{...F,status:x}}))}};d.useEffect(()=>{y.product_shop&&P()},[y]),d.useEffect(()=>{j({product_shop:e==null?void 0:e._id,limit:U,page:1})},[e]);const v=i.map(p=>Object.entries(p).map(([O,w])=>w));return t.jsxs(t.Fragment,{children:[t.jsx(me,{isFetching:S,cb_refetch:P,title:s("Products Management")}),t.jsxs("div",{className:"flex flex-col-reverse gap-4 mb-5 md:flex-col lg:flex-row lg:justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:gap-[14px]",children:[t.jsxs("button",{className:"btn btn--primary",children:["Add new product ",t.jsx("i",{className:"icon-circle-plus-regular"})]}),t.jsxs(Ze,{className:"btn btn--outline blue !h-[44px]",data:v,children:["Export CSV ",t.jsx("i",{className:"icon-file-export-solid"})]})]}),t.jsx(Ee,{query:a,setQuery:r,cb_setParamsSearch:()=>{j(p=>({...p,page:1,keyword:a}))},wrapperClass:"lg:w-[326px]",placeholder:"Search Product"})]}),t.jsx(Ye,{cb_onGetProductsByShop:P,cb_setParamsPage:p=>{j(o=>({...o,...p}))},cb_setParamsStatus:p=>{const o={all:{},trash:{isDelete:!0},publish:{isDelete:!1,isPublished:!0},draft:{isDelete:!1,isPublished:!1}};j({product_shop:e==null?void 0:e._id,limit:U,page:1,...o[p]})},cb_setParamsFilter:p=>{j(o=>({...o,page:1,...p}))},products:i,options:c,status:f,userInfo:e})]})};export{St as default};
