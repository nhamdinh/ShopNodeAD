var de=Object.defineProperty;var pe=(e,t,a)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var A=(e,t,a)=>(pe(e,typeof t!="symbol"?t+"":t,a),a);import{p as g,j as s,P as q,C as ue}from"./mui-2493782d.js";import{P as me}from"./PageHeader-8dc226f4.js";import{_ as he,g as xe,w as ge,u as fe,a as be,j as W,m as je,s as ye,x as R,y as Se,z as ve,F as Ce,B as _e,C as we,D as Ne,v as Pe,E as z,o as H,n as Oe,q as ke,G as Ae}from"./index-f5793006.js";import{h as J,T as Ee,C as Fe,r as p}from"./antd-1d728b6a.js";import{S as w}from"./index-8d8d8ff4.js";import{E as Te}from"./Empty-0bb19490.js";import{P as Re}from"./Pagination-94a491c8.js";import{S as Ue}from"./SubmenuTrigger-34b58daa.js";import{u as De}from"./usePaginationApi-bfea6451.js";import{P as Le}from"./columnDefs-17e744f7.js";import{r as Be}from"./commonFunction-f8b3aaf0.js";import"./DocumentTitle-62345d26.js";import"./RatingStars-632e9c20.js";import"./Timestamp-eb25fa85.js";import"./Trend-1bb25368.js";import"./Counter-934451c1.js";import"./helpers-22670235.js";const Ie=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Z=e=>Array.isArray(e)&&e.every(t=>typeof t=="object"&&!(t instanceof Array)),$e=e=>Array.isArray(e)&&e.every(t=>Array.isArray(t)),Me=e=>Array.from(e.map(t=>Object.keys(t)).reduce((t,a)=>new Set([...t,...a]),[])),qe=(e,t)=>{t=t||Me(e);let a=t,r=t;Z(t)&&(a=t.map(l=>l.label),r=t.map(l=>l.key));const i=e.map(l=>r.map(o=>Ge(o,l)));return[a,...i]},Ge=(e,t)=>{const a=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(r,i,l,o){const m=r[i];if(m==null)o.splice(1);else return m},t);return a===void 0?e in t?t[e]:"":a},Ke=e=>typeof e>"u"||e===null?"":e,X=(e,t=",",a='"')=>e.filter(r=>r).map(r=>r.map(i=>Ke(i)).map(i=>`${a}${i}${a}`).join(t)).join(`
`),Ve=(e,t,a,r)=>X(t?[t,...e]:e,a,r),ze=(e,t,a,r)=>X(qe(e,t),a,r),He=(e,t,a,r)=>t?`${t.join(a)}
${e}`:e.replace(/"/g,'""'),Y=(e,t,a,r)=>{if(Z(e))return ze(e,t,a,r);if($e(e))return Ve(e,t,a,r);if(typeof e=="string")return He(e,t,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},ee=(e,t,a,r,i)=>{const l=Y(e,a,r,i),o=Ie()?"application/csv":"text/csv",m=new Blob([t?"\uFEFF":"",l],{type:o}),f=`data:${o};charset=utf-8,${t?"\uFEFF":""}${l}`,x=window.URL||window.webkitURL;return typeof x.createObjectURL>"u"?f:x.createObjectURL(m)},te={data:g.oneOfType([g.string,g.array,g.func]).isRequired,headers:g.array,target:g.string,separator:g.string,filename:g.string,uFEFF:g.bool,onClick:g.func,asyncOnClick:g.bool,enclosingCharacter:g.string},se={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},Qe={target:"_blank"};class Q extends J.Component{constructor(t){super(t),this.state={}}buildURI(){return ee(...arguments)}componentDidMount(){const{data:t,headers:a,separator:r,enclosingCharacter:i,uFEFF:l,target:o,specs:m,replace:f}=this.props;this.state.page=window.open(this.buildURI(t,l,a,r,i),o,m,f)}getWindow(){return this.state.page}render(){return null}}A(Q,"defaultProps",Object.assign(se,Qe)),A(Q,"propTypes",te);var T;let We=(T=class extends J.Component{constructor(t){super(t),this.buildURI=this.buildURI.bind(this)}buildURI(){return ee(...arguments)}handleLegacy(t,a=!1){if(window.navigator.msSaveOrOpenBlob){t.preventDefault();const{data:r,headers:i,separator:l,filename:o,enclosingCharacter:m,uFEFF:f}=this.props,x=a&&typeof r=="function"?r():r;let b=new Blob([f?"\uFEFF":"",Y(x,i,l,m)]);return window.navigator.msSaveBlob(b,o),!1}}handleAsyncClick(t){const a=r=>{if(r===!1){t.preventDefault();return}this.handleLegacy(t,!0)};this.props.onClick(t,a)}handleSyncClick(t){if(this.props.onClick(t)===!1){t.preventDefault();return}this.handleLegacy(t)}handleClick(){return t=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(t):this.handleSyncClick(t);this.handleLegacy(t)}}render(){const{data:t,headers:a,separator:r,filename:i,uFEFF:l,children:o,onClick:m,asyncOnClick:f,enclosingCharacter:x,...b}=this.props,S=typeof window>"u"?"":this.buildURI(t,l,a,r,x);return s.jsx("a",{download:i,...b,ref:y=>this.link=y,target:"_self",href:S,onClick:this.handleClick(),children:o})}},A(T,"defaultProps",se),A(T,"propTypes",te),T);const Je=We,Ze=he(Ee).withConfig({displayName:"styles__StyledTable",componentId:"sc-k8b1p0-0"})(["flex-grow:1;.ant-spin-nested-loading,.ant-spin-container{height:100%;}.ant-spin-container{display:flex;flex-direction:column;}.ant-table{flex-grow:1;background:transparent;}.ant-table-thead .ant-table-cell{background:var(--widget);padding:30px 15px 20px !important;border-bottom:1px solid var(--border) !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{text-align:right;padding-right:24px !important;}}.ant-table-tbody .ant-table-cell{border:none !important;padding:30px 15px !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{padding-right:24px !important;}}"]),ae=({product:e,activeCollapse:t,handleCollapse:a})=>{const r=e.product_quantity;return s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(Fe,{}),s.jsxs("div",{className:"flex items-center gap-2.5",children:[s.jsx("div",{className:"img-wrapper w-[40px] h-[40px] flex items-center justify-center",children:s.jsx("img",{src:(e==null?void 0:e.product_thumb_small)??(e==null?void 0:e.product_thumb),alt:"product"})}),s.jsx("h6",{className:"text-sm max-w-[70px] truncate",children:e.product_sku})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:`collapse-btn ${t===e._id?"active":""}`,"aria-label":"Toggle view",onClick:()=>a(e._id),children:s.jsx("i",{className:"icon icon-caret-down-solid"})}),s.jsx(xe,{to:"/product-editor","aria-label":"Edit",children:s.jsx("i",{className:"icon icon-pen-to-square-regular"})}),s.jsx(Ue,{})]})]}),s.jsx(ue,{in:t===e._id,children:s.jsx("table",{className:"basic-table",children:s.jsxs("tbody",{children:[s.jsx("tr",{children:s.jsx("td",{colSpan:2,children:"Product"})}),s.jsx("tr",{children:s.jsx("td",{colSpan:2,children:s.jsxs("div",{className:"flex gap-2.5",children:[s.jsx("div",{className:"img-wrapper w-[45px] h-[45px] flex items-center justify-center",children:s.jsx("img",{src:(e==null?void 0:e.product_thumb_small)??(e==null?void 0:e.product_thumb),alt:"product"})}),s.jsx("h6",{className:"text-sm max-w-[155px]",children:e.product_name})]})})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["SKU: ",e.product_sku]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Stock status:",r==null?"On Demand":s.jsxs("span",{children:[s.jsx("span",{className:`${r!==0?"text-green":"text-red"}`,children:r!==0?r>=ge?"In stock ":"Low Inventory ":"Out of stock "}),"(",r,")"]})]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Price: $",e.product_price]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,children:["Category:",s.jsx("button",{className:"capitalize text-accent ml-1",children:e.product_type})]})})]})})})]})};ae.propTypes={product:q.object.isRequired,activeCollapse:q.string.isRequired,handleCollapse:q.func.isRequired};const Xe=({products:e=[],options:t,status:a,userInfo:r,cb_setParamsPage:i,cb_setParamsStatus:l,cb_setParamsFilter:o,cb_onGetProductsByShop:m})=>{const f=fe(),{width:x}=be(),b=W(je),N={stockStatus:null,product_categories:null,productSeller:null,brand:null,additionalOptions:null},[S,y]=p.useState([]),[v,U]=p.useState("all"),[c,d]=p.useState(N),[C,P]=p.useState(null),[E,O]=p.useState(""),D=n=>({all:(t==null?void 0:t.countAll)??e.length,trash:(a==null?void 0:a.isDelete)??0,publish:(a==null?void 0:a.isPublished)??0,draft:(a==null?void 0:a.isDraft)??0})[n]??0,_=({value:n,label:u},h)=>{d(M=>({...M,[h]:{label:u,value:n}}))},L=()=>{const n=Be(c),u={};Object.keys(n).forEach(h=>{h==="product_categories"&&(u[h]=n[h].value),h==="brand"&&(u[h]=n[h].value)}),o&&(o(u),y([]),j.setCurrentPage(0))},[B,{isLoading:I,error:G}]=ye(),$=async n=>{const u=await B(n),h=u==null?void 0:u.data;h!=null&&h.metadata?(m&&m(),y([]),f(H({isOpen:Date.now(),content:"Updated Success",step:1}))):f(H({isOpen:Date.now(),content:"Update Failed",step:2}))},K=()=>{var h;const n=(h=z.find(M=>M.value===C.value))==null?void 0:h.bodyUpdate,u={ids:S,bodyUpdate:n,product_shop:r==null?void 0:r._id};$(u)},k=()=>{d(N)},j=De({...t,data:(()=>v==="all"?e:e.filter(n=>n.status===v))(),limit:R});p.useEffect(()=>{O("")},[x]),p.useEffect(()=>{i&&(y([]),i({page:+j.currentPage>0?+j.currentPage+1:1}))},[j.currentPage]);const ne=n=>{O(E===n?"":n)},re=n=>{y(n)};p.useState("All");const[ie,le]=p.useState([]),{data:F,error:Ye,isSuccess:ce,isLoading:et}=Se({page:1,limit:1e3},{refetchOnMountOrArgChange:!0,skip:!1});p.useEffect(()=>{ce&&le(F==null?void 0:F.brands.map(n=>({value:n._id,label:n.brand})))},[F]);const oe=S.length===0||!C;return s.jsxs("div",{className:"flex flex-col flex-1",children:[s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.jsx("span",{className:"text-header",children:"Products:"}),s.jsx("div",{children:ve.map((n,u)=>s.jsx(Ce,{text:n.label,qty:D(n.value),value:n.value,active:v,onClick:()=>{console.log(n.value),l&&(y([]),l(n.value)),U(n.value),j.setCurrentPage(0)}},`filter-${u}`))})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3 md:gap-x-6 xl:grid-cols-6",children:[s.jsx(w,{options:_e,value:c.stockStatus,placeholder:"Stock Status",onChange:n=>_(n,"stockStatus")}),s.jsx(w,{options:b,value:c.product_categories,placeholder:"Product Category",onChange:n=>_(n,"product_categories")}),s.jsx(w,{options:we,value:c.productSeller,placeholder:"Product Seller",onChange:n=>_(n,"productSeller")}),s.jsx(w,{options:ie,value:c.brand,placeholder:"Product Brands",onChange:n=>_(n,"brand")}),s.jsx(w,{options:Ne,value:c.additionalOptions,placeholder:"Additional Options",onChange:n=>_(n,"additionalOptions")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{className:"btn btn--secondary !gap-[5px]",onClick:L,children:["Apply ",s.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),s.jsx("button",{className:"btn btn--outline blue !h-[44px]",onClick:k,children:"Clear"})]})]}),s.jsxs("div",{className:"flex flex-col-reverse gap-4 mt-4 mb-5 md:flex-row md:justify-between md:items-end md:mt-5 md:mb-6",children:[s.jsxs("p",{children:["View products: ",j.showingOf()]}),s.jsx("div",{children:s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{disabled:oe,className:"btn btn--outline red !gap-[5px]",onClick:K,children:[I?s.jsx(Pe,{radius:30}):"Apply Action",s.jsx("i",{className:"icon-chevron-right-regular text-sm"})]}),s.jsx("div",{className:"md:min-w-[280px]",children:s.jsx(w,{options:z,value:C,placeholder:"Select Action",onChange:n=>{P(n)}})})]})})]}),s.jsxs("div",{className:"flex flex-1 flex-col gap-[22px]",children:[x>=768?s.jsx(Ze,{columns:Le,dataSource:j.currentItems(),rowKey:n=>n._id,locale:{emptyText:s.jsx(Te,{text:"No products found"})},rowSelection:{type:"checkbox",selectedRowKeys:S,onChange:re},pagination:!1}):s.jsx("div",{className:"flex flex-col gap-5",children:j.currentItems().map((n,u)=>s.jsx(ae,{product:n,handleCollapse:ne,activeCollapse:E},`product-${u}`))}),j.maxPage>1&&s.jsx(Re,{pagination:j})]})]})},yt=()=>{const e=W(Oe),[t,a]=p.useState(""),[r,i]=p.useState([]),[l,o]=p.useState({}),[m,f]=p.useState({}),[x,b]=p.useState({product_shop:e==null?void 0:e._id,limit:R,page:1}),[N,{isLoading:S,error:y}]=ke(),v=async()=>{var C;const c=await N(x),d=c==null?void 0:c.data;if(d){const{countAll:P,totalCount:E,totalPages:O,limit:D,page:_,isDelete:L,isPublished:B,isDraft:I}=d==null?void 0:d.metadata,G=(C=d==null?void 0:d.metadata)==null?void 0:C.products,$={countAll:P,totalCount:E,totalPages:O,limit:D,page:_};f({isDelete:L,isPublished:B,isDraft:I}),o($),i(G.map(k=>{const V=k.isDelete?"trash":k.isPublished?"publish":"draft";return{...k,status:V}}))}};p.useEffect(()=>{x.product_shop&&v()},[x]),p.useEffect(()=>{b({product_shop:e==null?void 0:e._id,limit:R,page:1})},[e]);const U=r.map(c=>Object.entries(c).map(([C,P])=>P));return s.jsxs(s.Fragment,{children:[s.jsx(me,{isFetching:S,cb_refetch:v,title:"Products Management"}),s.jsxs("div",{className:"flex flex-col-reverse gap-4 mb-5 md:flex-col lg:flex-row lg:justify-between",children:[s.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:gap-[14px]",children:[s.jsxs("button",{className:"btn btn--primary",children:["Add new product ",s.jsx("i",{className:"icon-circle-plus-regular"})]}),s.jsxs(Je,{className:"btn btn--outline blue !h-[44px]",data:U,children:["Export CSV ",s.jsx("i",{className:"icon-file-export-solid"})]})]}),s.jsx(Ae,{query:t,setQuery:a,cb_setParamsSearch:()=>{b(c=>({...c,page:1,keyword:t}))},wrapperClass:"lg:w-[326px]",placeholder:"Search Product"})]}),s.jsx(Xe,{cb_onGetProductsByShop:v,cb_setParamsPage:c=>{b(d=>({...d,...c}))},cb_setParamsStatus:c=>{const d={all:{},trash:{isDelete:!0},publish:{isDelete:!1,isPublished:!0},draft:{isDelete:!1,isPublished:!1}};b({product_shop:e==null?void 0:e._id,limit:R,page:1,...d[c]})},cb_setParamsFilter:c=>{b(d=>({...d,page:1,...c}))},products:r,options:l,status:m,userInfo:e})]})};export{yt as default};
